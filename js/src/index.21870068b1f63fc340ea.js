/*! For license information please see index.21870068b1f63fc340ea.js.LICENSE.txt */
(self.webpackChunkfractalize=self.webpackChunkfractalize||[]).push([[927],{1511:(e,n,t)=>{"use strict";e.exports=t.p+"assets/cat.ffe7e9324360231d5014.jpeg"},9463:(e,n,t)=>{"use strict";t.d(n,{a:()=>i,c:()=>r,g:()=>a});var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{};function r(e,n,t){return e(t={path:n,exports:{},require:function(e,n){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==n&&t.path)}},t.exports),t.exports}function a(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")&&1===Object.keys(e).length?e.default:e}},9441:(e,n,t)=>{"use strict";t.d(n,{S1:()=>te,V_:()=>X,EX:()=>ne});var i=t(4768),r=t(7715),a=t(9935);let s,l,o={},u=new a.xsS,c=0,h=-.02,m=!1,f=0,p=0,d=0,v=0;const g=()=>{if(0!=o.length)for(let e in o){let n=o[e].material;n.uniforms.maxIterations.value=b.maxIterations,n.uniforms.scale.value=b.scale,n.uniforms.focus.value.x=b.focus.x,n.uniforms.focus.value.y=b.focus.y}},w=(e,n,t,i)=>{let r=o[e].material;function a(e,n){n<t&&(e.value.x=i[n].re,e.value.y=i[n].im)}c=12,h=-.02,r.uniforms.time.value=12,r.uniforms.an.value=n,r.uniforms.nl.value=t,r.uniforms.maxIterations.value=b.maxIterations,a(r.uniforms.l1,0),a(r.uniforms.l2,1),a(r.uniforms.l3,2),a(r.uniforms.l4,3),a(r.uniforms.l5,4),a(r.uniforms.l6,5),a(r.uniforms.l7,6),a(r.uniforms.l8,7),a(r.uniforms.l9,8),a(r.uniforms.l10,9),a(r.uniforms.l11,10),a(r.uniforms.l12,11),a(r.uniforms.l13,14),a(r.uniforms.l14,13),a(r.uniforms.l15,14),a(r.uniforms.l16,15),a(r.uniforms.l17,16),a(r.uniforms.l18,17),a(r.uniforms.l19,18),a(r.uniforms.l20,19),a(r.uniforms.l21,20),a(r.uniforms.l22,21),a(r.uniforms.l23,22),a(r.uniforms.l24,23),a(r.uniforms.l25,24),a(r.uniforms.l26,25),a(r.uniforms.l27,26),a(r.uniforms.l28,27),a(r.uniforms.l29,28),a(r.uniforms.l30,29),a(r.uniforms.l31,30),a(r.uniforms.l32,31),a(r.uniforms.l33,32),a(r.uniforms.l34,33),a(r.uniforms.l35,34),a(r.uniforms.l36,35),a(r.uniforms.l37,36),a(r.uniforms.l38,37),a(r.uniforms.l39,38),a(r.uniforms.l40,39),a(r.uniforms.l41,40),a(r.uniforms.l42,41),a(r.uniforms.l43,42),a(r.uniforms.l44,43),a(r.uniforms.l45,44),a(r.uniforms.l46,45),a(r.uniforms.l47,46),a(r.uniforms.l48,47),a(r.uniforms.l49,48),a(r.uniforms.l50,49),a(r.uniforms.l51,50),a(r.uniforms.l52,51),a(r.uniforms.l53,52),a(r.uniforms.l54,53),a(r.uniforms.l55,54),a(r.uniforms.l56,55),a(r.uniforms.l57,56),a(r.uniforms.l58,57),a(r.uniforms.l59,58),a(r.uniforms.l60,59),a(r.uniforms.l61,60),a(r.uniforms.l62,61),a(r.uniforms.l63,62),a(r.uniforms.l64,63)},M=()=>{if(null==s)return;const[e,n]=(()=>{let{width:e,height:n}=document.getElementById("source");const t=window.innerWidth,i=window.innerHeight;let r=t-e-128,a=.85*i-64,s=Math.min(r/e,a/n),l=r*a*s,o=t-64,u=.85*i-n-128,c=Math.min(o/e,u/n);return l>o*u*c?(e*=s,n*=s):(e*=c,n*=c),e=Math.floor(e),n=Math.floor(n),[e,n]})();s.setSize(e,n)},x=()=>{if(null!=s){if(b.playing&&c>=0){c+=h,c=Math.max(0,c);for(let e in o)o[e].material.uniforms.time.value=c;requestAnimationFrame(x)}s.render(u,l)}};var I=t(1511);const b={playing:!0,model:"",outputSize:260,numValidSubsets:"",scale:1,focus:{x:0,y:0},numLejaPoints:32,maxIterations:8};var z=t(8075),S=t(1166),F=t(9463);function y(e,n,t){var i,r,a;if(0==n)i=r=a=t;else{var s=function(e,n,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+6*(n-e)*t:t<.5?n:t<2/3?e+(n-e)*(2/3-t)*6:e},l=t<.5?t*(1+n):t+n-t*n,o=2*t-l;i=s(o,l,e+1/3),r=s(o,l,e),a=s(o,l,e-1/3)}return[Math.round(255*i),Math.round(255*r),Math.round(255*a)]}const j=async e=>await(0,i.z)({base:e,quantizationBytes:4});t(1026);var N=(0,F.c)((function(e,n){!function(n){var t=function(e){return.5*(Math.exp(e)+Math.exp(-e))},i=function(e){return.5*(Math.exp(e)-Math.exp(-e))},r=function(){throw SyntaxError("Invalid Param")};function a(e,n){var t=Math.abs(e),i=Math.abs(n);return 0===e?Math.log(i):0===n?Math.log(t):t<3e3&&i<3e3?.5*Math.log(e*e+n*n):Math.log(e/Math.cos(Math.atan2(n,e)))}function s(e,n){if(!(this instanceof s))return new s(e,n);var t=function(e,n){var t={re:0,im:0};if(null==e)t.re=t.im=0;else if(void 0!==n)t.re=e,t.im=n;else switch(typeof e){case"object":if("im"in e&&"re"in e)t.re=e.re,t.im=e.im;else if("abs"in e&&"arg"in e){if(!Number.isFinite(e.abs)&&Number.isFinite(e.arg))return s.INFINITY;t.re=e.abs*Math.cos(e.arg),t.im=e.abs*Math.sin(e.arg)}else if("r"in e&&"phi"in e){if(!Number.isFinite(e.r)&&Number.isFinite(e.phi))return s.INFINITY;t.re=e.r*Math.cos(e.phi),t.im=e.r*Math.sin(e.phi)}else 2===e.length?(t.re=e[0],t.im=e[1]):r();break;case"string":t.im=t.re=0;var i=e.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),a=1,l=0;null===i&&r();for(var o=0;o<i.length;o++){var u=i[o];" "===u||"\t"===u||"\n"===u||("+"===u?a++:"-"===u?l++:"i"===u||"I"===u?(a+l===0&&r()," "===i[o+1]||isNaN(i[o+1])?t.im+=parseFloat((l%2?"-":"")+"1"):(t.im+=parseFloat((l%2?"-":"")+i[o+1]),o++),a=l=0):((a+l===0||isNaN(u))&&r(),"i"===i[o+1]||"I"===i[o+1]?(t.im+=parseFloat((l%2?"-":"")+u),o++):t.re+=parseFloat((l%2?"-":"")+u),a=l=0))}a+l>0&&r();break;case"number":t.im=0,t.re=e;break;default:r()}return t}(e,n);this.re=t.re,this.im=t.im}s.prototype={re:0,im:0,sign:function(){var e=this.abs();return new s(this.re/e,this.im/e)},add:function(e,n){var t=new s(e,n);return this.isInfinite()&&t.isInfinite()?s.NAN:this.isInfinite()||t.isInfinite()?s.INFINITY:new s(this.re+t.re,this.im+t.im)},sub:function(e,n){var t=new s(e,n);return this.isInfinite()&&t.isInfinite()?s.NAN:this.isInfinite()||t.isInfinite()?s.INFINITY:new s(this.re-t.re,this.im-t.im)},mul:function(e,n){var t=new s(e,n);return this.isInfinite()&&t.isZero()||this.isZero()&&t.isInfinite()?s.NAN:this.isInfinite()||t.isInfinite()?s.INFINITY:0===t.im&&0===this.im?new s(this.re*t.re,0):new s(this.re*t.re-this.im*t.im,this.re*t.im+this.im*t.re)},div:function(e,n){var t=new s(e,n);if(this.isZero()&&t.isZero()||this.isInfinite()&&t.isInfinite())return s.NAN;if(this.isInfinite()||t.isZero())return s.INFINITY;if(this.isZero()||t.isInfinite())return s.ZERO;e=this.re,n=this.im;var i,r,a=t.re,l=t.im;return 0===l?new s(e/a,n/a):Math.abs(a)<Math.abs(l)?new s((e*(r=a/l)+n)/(i=a*r+l),(n*r-e)/i):new s((e+n*(r=l/a))/(i=l*r+a),(n-e*r)/i)},pow:function(e,n){var t=new s(e,n);if(e=this.re,n=this.im,t.isZero())return s.ONE;if(0===t.im){if(0===n&&e>0)return new s(Math.pow(e,t.re),0);if(0===e)switch((t.re%4+4)%4){case 0:return new s(Math.pow(n,t.re),0);case 1:return new s(0,Math.pow(n,t.re));case 2:return new s(-Math.pow(n,t.re),0);case 3:return new s(0,-Math.pow(n,t.re))}}if(0===e&&0===n&&t.re>0&&t.im>=0)return s.ZERO;var i=Math.atan2(n,e),r=a(e,n);return e=Math.exp(t.re*r-t.im*i),n=t.im*r+t.re*i,new s(e*Math.cos(n),e*Math.sin(n))},sqrt:function(){var e,n,t=this.re,i=this.im,r=this.abs();if(t>=0){if(0===i)return new s(Math.sqrt(t),0);e=.5*Math.sqrt(2*(r+t))}else e=Math.abs(i)/Math.sqrt(2*(r-t));return n=t<=0?.5*Math.sqrt(2*(r-t)):Math.abs(i)/Math.sqrt(2*(r+t)),new s(e,i<0?-n:n)},exp:function(){var e=Math.exp(this.re);return this.im,new s(e*Math.cos(this.im),e*Math.sin(this.im))},expm1:function(){var e=this.re,n=this.im;return new s(Math.expm1(e)*Math.cos(n)+function(e){var n=Math.PI/4;if(-n>e||e>n)return Math.cos(e)-1;var t=e*e;return t*(t*(t*(t*(t*(t*(t*(t/20922789888e3-1/87178291200)+1/479001600)-1/3628800)+1/40320)-1/720)+1/24)-.5)}(n),Math.exp(e)*Math.sin(n))},log:function(){var e=this.re,n=this.im;return new s(a(e,n),Math.atan2(n,e))},abs:function(){return function(e,n){var t=Math.abs(e),i=Math.abs(n);return t<3e3&&i<3e3?Math.sqrt(t*t+i*i):(t<i?(t=i,i=e/n):i=n/e,t*Math.sqrt(1+i*i))}(this.re,this.im)},arg:function(){return Math.atan2(this.im,this.re)},sin:function(){var e=this.re,n=this.im;return new s(Math.sin(e)*t(n),Math.cos(e)*i(n))},cos:function(){var e=this.re,n=this.im;return new s(Math.cos(e)*t(n),-Math.sin(e)*i(n))},tan:function(){var e=2*this.re,n=2*this.im,r=Math.cos(e)+t(n);return new s(Math.sin(e)/r,i(n)/r)},cot:function(){var e=2*this.re,n=2*this.im,r=Math.cos(e)-t(n);return new s(-Math.sin(e)/r,i(n)/r)},sec:function(){var e=this.re,n=this.im,r=.5*t(2*n)+.5*Math.cos(2*e);return new s(Math.cos(e)*t(n)/r,Math.sin(e)*i(n)/r)},csc:function(){var e=this.re,n=this.im,r=.5*t(2*n)-.5*Math.cos(2*e);return new s(Math.sin(e)*t(n)/r,-Math.cos(e)*i(n)/r)},asin:function(){var e=this.re,n=this.im,t=new s(n*n-e*e+1,-2*e*n).sqrt(),i=new s(t.re-n,t.im+e).log();return new s(i.im,-i.re)},acos:function(){var e=this.re,n=this.im,t=new s(n*n-e*e+1,-2*e*n).sqrt(),i=new s(t.re-n,t.im+e).log();return new s(Math.PI/2-i.im,i.re)},atan:function(){var e=this.re,n=this.im;if(0===e){if(1===n)return new s(0,1/0);if(-1===n)return new s(0,-1/0)}var t=e*e+(1-n)*(1-n),i=new s((1-n*n-e*e)/t,-2*e/t).log();return new s(-.5*i.im,.5*i.re)},acot:function(){var e=this.re,n=this.im;if(0===n)return new s(Math.atan2(1,e),0);var t=e*e+n*n;return 0!==t?new s(e/t,-n/t).atan():new s(0!==e?e/0:0,0!==n?-n/0:0).atan()},asec:function(){var e=this.re,n=this.im;if(0===e&&0===n)return new s(0,1/0);var t=e*e+n*n;return 0!==t?new s(e/t,-n/t).acos():new s(0!==e?e/0:0,0!==n?-n/0:0).acos()},acsc:function(){var e=this.re,n=this.im;if(0===e&&0===n)return new s(Math.PI/2,1/0);var t=e*e+n*n;return 0!==t?new s(e/t,-n/t).asin():new s(0!==e?e/0:0,0!==n?-n/0:0).asin()},sinh:function(){var e=this.re,n=this.im;return new s(i(e)*Math.cos(n),t(e)*Math.sin(n))},cosh:function(){var e=this.re,n=this.im;return new s(t(e)*Math.cos(n),i(e)*Math.sin(n))},tanh:function(){var e=2*this.re,n=2*this.im,r=t(e)+Math.cos(n);return new s(i(e)/r,Math.sin(n)/r)},coth:function(){var e=2*this.re,n=2*this.im,r=t(e)-Math.cos(n);return new s(i(e)/r,-Math.sin(n)/r)},csch:function(){var e=this.re,n=this.im,r=Math.cos(2*n)-t(2*e);return new s(-2*i(e)*Math.cos(n)/r,2*t(e)*Math.sin(n)/r)},sech:function(){var e=this.re,n=this.im,r=Math.cos(2*n)+t(2*e);return new s(2*t(e)*Math.cos(n)/r,-2*i(e)*Math.sin(n)/r)},asinh:function(){var e=this.im;this.im=-this.re,this.re=e;var n=this.asin();return this.re=-this.im,this.im=e,e=n.re,n.re=-n.im,n.im=e,n},acosh:function(){var e=this.acos();if(e.im<=0){var n=e.re;e.re=-e.im,e.im=n}else n=e.im,e.im=-e.re,e.re=n;return e},atanh:function(){var e=this.re,n=this.im,t=e>1&&0===n,i=1-e,r=1+e,l=i*i+n*n,o=0!==l?new s((r*i-n*n)/l,(n*i+r*n)/l):new s(-1!==e?e/0:0,0!==n?n/0:0),u=o.re;return o.re=a(o.re,o.im)/2,o.im=Math.atan2(o.im,u)/2,t&&(o.im=-o.im),o},acoth:function(){var e=this.re,n=this.im;if(0===e&&0===n)return new s(0,Math.PI/2);var t=e*e+n*n;return 0!==t?new s(e/t,-n/t).atanh():new s(0!==e?e/0:0,0!==n?-n/0:0).atanh()},acsch:function(){var e=this.re,n=this.im;if(0===n)return new s(0!==e?Math.log(e+Math.sqrt(e*e+1)):1/0,0);var t=e*e+n*n;return 0!==t?new s(e/t,-n/t).asinh():new s(0!==e?e/0:0,0!==n?-n/0:0).asinh()},asech:function(){var e=this.re,n=this.im;if(this.isZero())return s.INFINITY;var t=e*e+n*n;return 0!==t?new s(e/t,-n/t).acosh():new s(0!==e?e/0:0,0!==n?-n/0:0).acosh()},inverse:function(){if(this.isZero())return s.INFINITY;if(this.isInfinite())return s.ZERO;var e=this.re,n=this.im,t=e*e+n*n;return new s(e/t,-n/t)},conjugate:function(){return new s(this.re,-this.im)},neg:function(){return new s(-this.re,-this.im)},ceil:function(e){return e=Math.pow(10,e||0),new s(Math.ceil(this.re*e)/e,Math.ceil(this.im*e)/e)},floor:function(e){return e=Math.pow(10,e||0),new s(Math.floor(this.re*e)/e,Math.floor(this.im*e)/e)},round:function(e){return e=Math.pow(10,e||0),new s(Math.round(this.re*e)/e,Math.round(this.im*e)/e)},equals:function(e,n){var t=new s(e,n);return Math.abs(t.re-this.re)<=s.EPSILON&&Math.abs(t.im-this.im)<=s.EPSILON},clone:function(){return new s(this.re,this.im)},toString:function(){var e=this.re,n=this.im,t="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(e)<s.EPSILON&&(e=0),Math.abs(n)<s.EPSILON&&(n=0),0===n?t+e:(0!==e?(t+=e,t+=" ",n<0?(n=-n,t+="-"):t+="+",t+=" "):n<0&&(n=-n,t+="-"),1!==n&&(t+=n),t+"i"))},toVector:function(){return[this.re,this.im]},valueOf:function(){return 0===this.im?this.re:null},isNaN:function(){return isNaN(this.re)||isNaN(this.im)},isZero:function(){return 0===this.im&&0===this.re},isFinite:function(){return isFinite(this.re)&&isFinite(this.im)},isInfinite:function(){return!(this.isNaN()||this.isFinite())}},s.ZERO=new s(0,0),s.ONE=new s(1,0),s.I=new s(0,1),s.PI=new s(Math.PI,0),s.E=new s(Math.E,0),s.INFINITY=new s(1/0,1/0),s.NAN=new s(NaN,NaN),s.EPSILON=1e-15,Object.defineProperty(s,"__esModule",{value:!0}),s.default=s,s.Complex=s,e.exports=s}()})).Complex;const E=(e,n,t)=>{if(0==e.length)return n[t].abs();var i=1;for(let r=0;r<e.length;r++)i*=n[t].sub(e[r]).abs();return i},P=e=>{let n=1;for(let t=0;t<e.length-1;t++)n*=e[e.length-1].sub(e[t]).abs();return n},C=e=>{let n=0,t=0;for(let i=0;i<e.length;i++){let r=e[i];n+=r.re,t+=r.im}return n/=e.length,t/=e.length,new N(n,t)},L="'([^']+)'|\"([^\"]+)\"|[\\w\\s-]+",D=new RegExp("(bold|bolder|lighter|[1-9]00) +","i"),k=new RegExp("(italic|oblique) +","i"),O=new RegExp("(small-caps) +","i"),q=new RegExp("(ultra-condensed|extra-condensed|condensed|semi-condensed|semi-expanded|expanded|extra-expanded|ultra-expanded) +","i"),T=new RegExp("([\\d\\.]+)(px|pt|pc|in|cm|mm|%|em|ex|ch|rem|q) *((?:"+L+")( *, *(?:"+L+"))*)"),B={};var R={parseFont:function(e){if(B[e])return B[e];const n=T.exec(e);if(!n)return;const t={weight:"normal",style:"normal",stretch:"normal",variant:"normal",size:parseFloat(n[1]),unit:n[2],family:n[3].replace(/["']/g,"").replace(/ *, */g,",")};let i,r,a,s,l=e.substring(0,n.index);switch((i=D.exec(l))&&(t.weight=i[1]),(r=k.exec(l))&&(t.style=r[1]),(a=O.exec(l))&&(t.variant=a[1]),(s=q.exec(l))&&(t.stretch=s[1]),t.unit){case"pt":t.size/=.75;break;case"pc":t.size*=16;break;case"in":t.size*=96;break;case"cm":t.size*=96/2.54;break;case"mm":t.size*=96/25.4;break;case"%":break;case"em":case"rem":t.size*=16/.75;break;case"q":t.size*=96/25.4/4}return B[e]=t},createCanvas:function(e,n){return Object.assign(document.createElement("canvas"),{width:e,height:n})},createImageData:function(e,n,t){switch(arguments.length){case 0:return new ImageData;case 1:return new ImageData(e);case 2:return new ImageData(e,n);default:return new ImageData(e,n,t)}},loadImage:function(e,n){return new Promise((function(t,i){const r=Object.assign(document.createElement("img"),n);function a(){r.onload=null,r.onerror=null}r.onload=function(){a(),t(r)},r.onerror=function(){a(),i(new Error('Failed to load the image "'+e+'"'))},r.src=e}))}};class W{constructor(e,n,t,i=e<<16|n<<8|t){this.isColor=!0,this.red=e,this.green=n,this.blue=t,this.hex=i,this.count=1}distance(e){return(Math.abs(e.red-this.red)+Math.abs(e.green-this.green)+Math.abs(e.blue-this.blue))/765}getWeight(e,n){return this.count/n*(1-e)+this.getSaturation()*e}getSaturation(){return void 0===this.saturation&&(this.saturation=Math.max(Math.abs(this.red-this.green)/255,Math.abs(this.red-this.blue)/255,Math.abs(this.green-this.blue)/255)),this.saturation}}class A{constructor(){this.count=1,this.children={}}addGroup(e){return this.children[e]?this.children[e].count++:this.children[e]=new A,this.children[e]}addColor(e,n,t,i){return this.children[e]?this.children[e].count++:this.children[e]=new W(n,t,i,e),this.children[e]}getList(){return Object.keys(this.children).map((e=>this.children[e]))}getMaxWeight(e,n){if(void 0===this.maxWeight){const t=this.getList().map((t=>t.isColor?t.getWeight(e,n):t.getMaxWeight(e,n)));t.sort(((e,n)=>n-e)),this.maxWeight=t[0]||0}return this.maxWeight}getMaxWeightColor(e,n){const t=this.getList();return t.sort(((t,i)=>t.isColor?i.getWeight(e,n)-t.getWeight(e,n):i.getMaxWeight(e,n)-t.getMaxWeight(e,n))),t[0].isColor?t[0]:t[0].getMaxWeightColor(e,n)}getMaxCountColor(){const e=this.getList();return e.sort(((e,n)=>e.isColor?n.count-e.count:n.getMaxCountColor()-e.getMaxCountColor())),e[0].isColor?e[0]:e[0].getMaxCountColor()}getColors(e,n,t){const i=this.getList().map((e=>{const{count:n}=e,t=e.getMaxCountColor();return t.count=n,t}));i.sort(((e,i)=>i.getWeight(n,t)-e.getWeight(n,t)));const r=[];return i.forEach((n=>{const t=r.find((t=>t.distance(n)<e));t?t.count+=n.count:r.push(n)})),r}}const V=(e,n,t=0,i=Number.MAX_VALUE)=>{if(Number(n)!==n||n<t||n>i)throw new Error(e+" is invalid");return Number(n)};class Z{constructor({pixels:e=Z.pixelsDefault,distance:n=Z.distanceDefault,saturationImportance:t=Z.saturationImportanceDefault,splitPower:i=Z.splitPowerDefault,colorValidator:r=Z.colorValidatorDefault}={}){this.pixels=((e,n,t=0,i=Number.MAX_SAFE_INTEGER)=>{if(!Number.isInteger(n)||n<t||n>i)throw new Error(e+" is invalid");return parseInt(n)})("pixels",e,1),this.splitPower=V("splitPower",i,2,16),this.distance=V("distance",n,0,1),this.saturationImportance=V("saturationImportance",t,0,1),this.colorValidator=((e,n)=>{if(!n||"[object Function]"!=={}.toString.call(n))throw new Error("colorValidator is invalid");return n})(0,r)}process(e){const n=new A,t=this.splitPower;for(let i=0;i<e.length;i+=4){const r=e[i],a=e[i+1],s=e[i+2],l=e[i+3];if(this.colorValidator(r,a,s,l)){const e=r<<16|a<<8|s,i=(r>>4&15)<<2|(a>>4&15)<<1|s>>4&15,l=Math.round(r*(t-1)/255)*(t*t)+Math.round(a*(t-1)/255)*t+Math.round(s*(t-1)/255);n.addGroup(l).addGroup(i).addColor(e,r,a,s)}}return n.getColors(this.distance,this.saturationImportance,this.pixels)}extract(e){return this.process(e).map((e=>({hex:`#${"0".repeat(6-e.hex.toString(16).length)}${e.hex.toString(16)}`,red:e.red,green:e.green,blue:e.blue,area:e.count/this.pixels,saturation:e.saturation/255})))}}Z.pixelsDefault=1e4,Z.distanceDefault=.2,Z.saturationImportanceDefault=.2,Z.splitPowerDefault=10,Z.colorValidatorDefault=(e,n,t,i=255)=>i>250;const{createCanvas:Y,loadImage:K}=R,U=(e,n)=>new Z(n).extract(e.data),$=(e,n)=>K(e).then((e=>{const t=new Z(n),i=((e,n)=>{const t=e.width*e.height,i=t<n?e.width:Math.round(e.width*Math.sqrt(n/t)),r=t<n?e.height:Math.round(e.height*Math.sqrt(n/t)),a=Y(i,r).getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,i,r),a.getImageData(0,0,i,r)})(e,t.pixels);return t.extract(i.data)})),_=(e,n)=>e.width&&e.height&&e.data&&e.data.length?new Promise((t=>{t(U(e,n))})):$(e,n);let X=!0,G=!1;const H=(()=>{const e=window.location.search,n=new URLSearchParams(e);let t=n.get("img");const i=n.get("nl"),r=n.get("mi"),a=n.get("si");return null!=i&&(b.numLejaPoints=parseInt(i)),null!=r&&(b.maxIterations=parseInt(r)),"false"==a&&document.getElementById("source").classList.add("hidden"),null==t&&(t=I),t})();(()=>{const e=new r.X({container:document.getElementById("settingsPanel"),title:"Parameters",expanded:!0});b.outputSize=513,e.addInput(b,"model",{options:{ade20k:"ade20k",pascal:"pascal",cityscapes:"cityscapes"}}).on("change",(e=>{ne()})),e.addInput(b,"playing").on("change",(e=>{x()})),e.addInput(b,"maxIterations",{min:4,max:64,step:1}).on("change",(e=>{g(),x()})),e.addSeparator(),e.addMonitor(b,"numValidSubsets"),e.addSeparator(),e.addButton({title:"load random image"}).on("click",(()=>{X||te("https://source.unsplash.com/random")}))})();const J=new class{constructor(){var e,n;n=void 0,(e="pane")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this.pane=n;let t=document.createElement("div");t.setAttribute("id","loading-pane"),document.body.appendChild(t);let i=document.createElement("div");i.setAttribute("id","loading-messages"),t=document.getElementById("loading-pane"),t.appendChild(i)}hidePane(){document.getElementById("loading-pane").style.display="none"}showPane(){let e=document.getElementById("loading-pane");e.classList.remove("hidden"),e.style.display="flex"}clear(){this.sendMessage("")}sendMessage(e){""==e?this.hidePane():this.showPane(),document.getElementById("loading-messages").innerHTML=e}};z.N("webgl");let Q={models:{pascal:null,ade20k:null,cityscapes:null},imgData:null,colorscheme:null,complexPoints:null,centers:null};const ee=(e,n,t,i)=>{J.sendMessage("generating leja points");const r=(e=>{let n={};for(var t in e){const s=e[t];let l=[];const o=Math.min(b.numLejaPoints,Math.floor(s.length/2));let u=[];for(let e=0;e<o;e++){var i=0,r=0,a=0;for(let e=0;e<s.length;e++)l.includes(e)||(a=E(u,s,e))>i&&(i=a,r=e);u.push(s[r]),l.push(r)}n[t]=u}return n})(e),I=(e=>{var n={};for(var t in e){let i=e[t];n[t]=P(i)}return n})(r);J.sendMessage("setting up renderer"),((e,n,t,i,r)=>{if(o.length>0)return void((e,n)=>{for(let t in e)w(o[t],n[t],e[t].length,e[t])})(e,n);null==s?((()=>{s=new a.CP7({alpha:!0,depth:!1});const e=document.getElementById("fractal-container");s.domElement.setAttribute("id","fractal"),s.domElement.classList.add("flex-box"),M(),e.appendChild(s.domElement),window.onresize=M,l=new a.iKG(-1,1,1,-1,.1,10),l.position.z=3;const n=document.getElementById("fractal");n.addEventListener("mouseover",(()=>{h=.01,c<=0&&(c=Math.max(c,0),x())})),n.addEventListener("mouseout",(()=>{h=-.02}))})(),(()=>{const e=document.getElementById("fractal");e.addEventListener("mousedown",(e=>{m=!0,d=e.clientX,v=e.clientY})),e.addEventListener("mouseup",(()=>{m=!1})),e.addEventListener("mousemove",(e=>{if(m){f=e.clientX,p=e.clientY;let n=f-d,t=p-v;d=f,v=p,b.focus.x+=.01*n/b.scale,b.focus.y+=.01*t/b.scale,g(),b.playing||x()}}))})()):M();let I=0;for(let e in r)r[e]>I&&(I=r[e]);o={},u.clear();const z=new a.BKK(2,2);for(let s in e){let l=e[s],h=n[s],m=t[s],f=r[s],p=i[s];z.translate(0,0,f/I*-.1);const d=new a.jyz({uniforms:{an:{value:h},nl:{value:l.length},time:{value:c},maxIterations:{value:8},scale:{value:1},color:{value:new a.Pa4(p[0],p[1],p[2])},origin:{value:new a.FM8(m.re,m.im)},focus:{value:new a.FM8(b.focus.x,b.focus.y)},l1:{value:new a.FM8},l2:{value:new a.FM8},l3:{value:new a.FM8},l4:{value:new a.FM8},l5:{value:new a.FM8},l6:{value:new a.FM8},l7:{value:new a.FM8},l8:{value:new a.FM8},l9:{value:new a.FM8},l10:{value:new a.FM8},l11:{value:new a.FM8},l12:{value:new a.FM8},l13:{value:new a.FM8},l14:{value:new a.FM8},l15:{value:new a.FM8},l16:{value:new a.FM8},l17:{value:new a.FM8},l18:{value:new a.FM8},l19:{value:new a.FM8},l20:{value:new a.FM8},l21:{value:new a.FM8},l22:{value:new a.FM8},l23:{value:new a.FM8},l24:{value:new a.FM8},l25:{value:new a.FM8},l26:{value:new a.FM8},l27:{value:new a.FM8},l28:{value:new a.FM8},l29:{value:new a.FM8},l30:{value:new a.FM8},l31:{value:new a.FM8},l32:{value:new a.FM8},l33:{value:new a.FM8},l34:{value:new a.FM8},l35:{value:new a.FM8},l36:{value:new a.FM8},l37:{value:new a.FM8},l38:{value:new a.FM8},l39:{value:new a.FM8},l40:{value:new a.FM8},l41:{value:new a.FM8},l42:{value:new a.FM8},l43:{value:new a.FM8},l44:{value:new a.FM8},l45:{value:new a.FM8},l46:{value:new a.FM8},l47:{value:new a.FM8},l48:{value:new a.FM8},l49:{value:new a.FM8},l50:{value:new a.FM8},l51:{value:new a.FM8},l52:{value:new a.FM8},l53:{value:new a.FM8},l54:{value:new a.FM8},l55:{value:new a.FM8},l56:{value:new a.FM8},l57:{value:new a.FM8},l58:{value:new a.FM8},l59:{value:new a.FM8},l60:{value:new a.FM8},l61:{value:new a.FM8},l62:{value:new a.FM8},l63:{value:new a.FM8},l64:{value:new a.FM8}},vertexShader:"\n      varying vec3 vUv;\n      \n      void main() {\n          vUv = position;\n  \n          vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_Position = projectionMatrix * modelViewPosition;    }\n      ",fragmentShader:"\n      uniform float an;\n      uniform int nl;\n      uniform float time;\n      uniform int maxIterations;\n      uniform float scale;\n      uniform vec2 origin;\n      uniform vec2 focus;\n      uniform vec3 color;\n  \n      uniform vec2 l1;\n      uniform vec2 l2;\n      uniform vec2 l3;\n      uniform vec2 l4;\n      uniform vec2 l5;\n      uniform vec2 l6;\n      uniform vec2 l7;\n      uniform vec2 l8;\n      uniform vec2 l9;\n      uniform vec2 l10;\n      uniform vec2 l11;\n      uniform vec2 l12;\n      uniform vec2 l13;\n      uniform vec2 l14;\n      uniform vec2 l15;\n      uniform vec2 l16;\n      uniform vec2 l17;\n      uniform vec2 l18;\n      uniform vec2 l19;\n      uniform vec2 l20;\n      uniform vec2 l21;\n      uniform vec2 l22;\n      uniform vec2 l23;\n      uniform vec2 l24;\n      uniform vec2 l25;\n      uniform vec2 l26;\n      uniform vec2 l27;\n      uniform vec2 l28;\n      uniform vec2 l29;\n      uniform vec2 l30;\n      uniform vec2 l31;\n      uniform vec2 l32; \n      uniform vec2 l33;\n      uniform vec2 l34;\n      uniform vec2 l35;\n      uniform vec2 l36;\n      uniform vec2 l37;\n      uniform vec2 l38;\n      uniform vec2 l39;\n      uniform vec2 l40;\n      uniform vec2 l41;\n      uniform vec2 l42;\n      uniform vec2 l43;\n      uniform vec2 l44;\n      uniform vec2 l45;\n      uniform vec2 l46;\n      uniform vec2 l47;\n      uniform vec2 l48;\n      uniform vec2 l49;\n      uniform vec2 l50;\n      uniform vec2 l51;\n      uniform vec2 l52;\n      uniform vec2 l53;\n      uniform vec2 l54;\n      uniform vec2 l55;\n      uniform vec2 l56;\n      uniform vec2 l57;\n      uniform vec2 l58;\n      uniform vec2 l59;\n      uniform vec2 l60;\n      uniform vec2 l61;\n      uniform vec2 l62;\n      uniform vec2 l63;\n      uniform vec2 l64;\n  \n      varying vec3 vUv;\n  \n      vec2 lejaStep(vec2 z, vec2 p, vec2 l, int n) {\n          if (n > nl) return p;\n          vec2 r = vec2(z.x-l.x, z.y-l.y) * (1.0+0.07*sin(time*0.13));\n          vec2 p2 = vec2(p.x * r.x - p.y * r.y, p.x * r.y + p.y * r.x);\n          return p2;\n      }\n  \n      vec2 P(vec2 z) {\n          vec2 p = vec2(z.x - l1.x,z.y - l1.y);\n          \n          p = lejaStep(z,p,l2,2);\n          p = lejaStep(z,p,l3,3);\n          p = lejaStep(z,p,l4,4);\n          p = lejaStep(z,p,l5,5);\n          p = lejaStep(z,p,l6,6);\n          p = lejaStep(z,p,l7,7);\n          p = lejaStep(z,p,l8,8);\n          p = lejaStep(z,p,l9,9);\n          p = lejaStep(z,p,l10,10);\n          p = lejaStep(z,p,l11,11);\n          p = lejaStep(z,p,l12,12);\n          p = lejaStep(z,p,l13,13);\n          p = lejaStep(z,p,l14,14);\n          p = lejaStep(z,p,l15,15);\n          p = lejaStep(z,p,l16,16);\n          p = lejaStep(z,p,l17,17);\n          p = lejaStep(z,p,l18,18);\n          p = lejaStep(z,p,l19,19);\n          p = lejaStep(z,p,l20,20);\n          p = lejaStep(z,p,l21,21);\n          p = lejaStep(z,p,l22,22);\n          p = lejaStep(z,p,l23,23);\n          p = lejaStep(z,p,l24,24);\n          p = lejaStep(z,p,l25,25);\n          p = lejaStep(z,p,l26,26);\n          p = lejaStep(z,p,l27,27);\n          p = lejaStep(z,p,l28,28);\n          p = lejaStep(z,p,l29,29);\n          p = lejaStep(z,p,l30,30);\n          p = lejaStep(z,p,l31,31);\n          p = lejaStep(z,p,l32,32); \n          p = lejaStep(z,p,l33,33);\n          p = lejaStep(z,p,l34,34);\n          p = lejaStep(z,p,l35,35);\n          p = lejaStep(z,p,l36,36);\n          p = lejaStep(z,p,l37,37);\n          p = lejaStep(z,p,l38,38);\n          p = lejaStep(z,p,l39,39);\n          p = lejaStep(z,p,l40,40);\n          p = lejaStep(z,p,l41,41);\n          p = lejaStep(z,p,l42,42);\n          p = lejaStep(z,p,l43,43);\n          p = lejaStep(z,p,l44,44);\n          p = lejaStep(z,p,l45,45);\n          p = lejaStep(z,p,l46,46);\n          p = lejaStep(z,p,l47,47);\n          p = lejaStep(z,p,l48,48);\n          p = lejaStep(z,p,l49,49);\n          p = lejaStep(z,p,l50,50);\n          p = lejaStep(z,p,l51,51);\n          p = lejaStep(z,p,l52,52);\n          p = lejaStep(z,p,l53,53);\n          p = lejaStep(z,p,l54,54);\n          p = lejaStep(z,p,l55,55);\n          p = lejaStep(z,p,l56,56);\n          p = lejaStep(z,p,l57,57);\n          p = lejaStep(z,p,l58,58);\n          p = lejaStep(z,p,l59,59);\n          p = lejaStep(z,p,l60,60);\n          p = lejaStep(z,p,l61,61);\n          p = lejaStep(z,p,l62,62);\n          p = lejaStep(z,p,l63,63);\n          p = lejaStep(z,p,l64,64);\n  \n          float scale = exp(0.5) / an;\n          return vec2(p.x*z.x - p.y*z.y, p.x*z.y + p.y*z.x) * scale;\n          \n      }\n  \n      vec3 hsv2rgb(vec3 c)\n      {\n          vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n          vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n          return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n  \n      void main() {\n          vec2 z = (vec2(vUv.x, -vUv.y) / (scale + 0.05 * sin(0.1 * time))) - origin - focus;\n          float len = 0.0;\n          int iterations = 0;\n          for (;iterations < maxIterations; iterations++) {\n              if (length(z) > 2.0) {\n                  break;\n              }\n              vec2 tmp = P(z);\n              len += length(z - tmp);\n              z = tmp;\n          }\n          float h =  sin(len * 0.5);\n          float s = 0.65;\n          float v = float(iterations)/float(maxIterations);\n          vec3 rgb = hsv2rgb(vec3(h,s,v));\n          //float a = v-0.2;\n          float a = mix(0.5+0.5*cos(1.0/float(iterations)),v - 0.2,clamp(0.7 + 0.5*sin(0.729+time*.09),0.8,1.0));\n          if (a < 0.1) {\n            discard;\n          }\n          gl_FragColor = vec4(mix(rgb,color,0.5 + 0.75*sin(0.729+time*0.05)), a);\n      }\n  ",depthTest:!1,depthWrite:!1,transparent:!0}),v=new a.Kj0(z,d);u.add(v),o[s]=v,w(s,h,l.length,l)}x()})(r,I,n,i,t),J.clear(),X=!1},ne=async(e=null)=>{J.sendMessage("segmenting image");const n=null==e?Q.imgData:e,t=Q.models[b.model],{segmentationMap:i}=await(async(e,n)=>{const{legend:t,segmentationMap:i}=await e.segment(n);return{legend:t,segmentationMap:i}})(t,n);J.sendMessage("finding closed jordan curves");const[r,a]=await((e,n)=>{const t=e.width,i=e.height;let r={},a={};const s=z.z([i,t]);let l=s.bufferSync();const o=S.cj.fromPixels(new ImageData(n,t,i)),u=o.bufferSync(),c=(e,n,r,a,s)=>{if(!(a<t&&a>=0&&s<i&&s>=0))return!1;const o=l.get(s,a)!=e;let c=!0;return[0,1,2].forEach((e=>{c=c&&u.get(s,a,e)==u.get(r,n,e)})),!(!o||!c)},h=(e,n)=>{let t,i,r=[e],a=0;for(;r.length>0;)[t,i]=r.pop(),l.set(n,t,i),a++,[[t,i+1],[t,i-1],[t+1,i],[t-1,i]].forEach((([e,a])=>{c(n,i,t,a,e)&&r.push([e,a])}));return a};let m=1;for(let e=0;e<t;e++)for(let n=0;n<i;n++)if(0==l.get(n,e)){let t=h([n,e],m);t>500&&(r[m]=[],a[m]=t),m++}for(let e=1;e<t-1;e++)for(let n=1;n<i-1;n++){const t=l.get(n,e);t in r&&(l.get(n,e-1)!=t||l.get(n,e+1)!=t||l.get(n+1,e)!=t||l.get(n-1,e)!=t||l.get(n-1,e-1)!=t||l.get(n+1,e+1)!=t||l.get(n+1,e-1)!=t||l.get(n-1,e+1)!=t)&&r[t].push([e,n])}const f=document.getElementById("source").getContext("2d");f.fillStyle="rgba(30,30,30,0.5)",f.fillRect(0,0,t,i);for(let e=0;e<t;e++)for(let n=0;n<i;n++){let t=l.get(n,e);if(t in r){let i=0,r=t/m;i=r<.5?r+.5:r-.5;let[a,s,l]=y(i,.6,.45);f.fillStyle=`rgba(${a},${s},${l},0.15)`,f.fillRect(e,n,1,1)}}b.numValidSubsets=Object.keys(r).length;for(let e in r){const n=r[e];for(let e=0;e<n.length;e++){let[t,i]=n[e];f.fillStyle="rgba(240,240,240,.7)",f.fillRect(t,i,1,1)}}return s.dispose(),o.dispose(),[r,a]})(n,i),s=(e=>{let n={},t=0,i=Q.colorscheme.length;for(let r in e){let e=t%i,a=Q.colorscheme[e];n[r]=[a.red/255,a.green/255,a.blue/255],t++}return n})(r),[l,o]=((e,n,t)=>{let i={};function r(e,i){let r=(e*(2/n)-1)*b.scale,a=(i*(2/t)-1)*b.scale;return new N(r,a)}let a=0,s={};for(let n in e){let t=e[n];s[n]=[];for(let e=0;e<t.length;e++)s[n].push(r(t[e][0],t[e][1])),a++}let l=Math.floor(100*a/(n*t));b.complexPoints=`${a} / ${n*t} (${l}%)`;for(let e in s){let n=C(s[e]);i[e]=n;for(let t=0;t<s[e].length;t++)s[e][t]=s[e][t].sub(n)}return[s,i]})(r,n.width,n.height);ee(l,o,a,s)},te=async e=>{X=!0,J.sendMessage("loading image");const{imgData:n}=await(async e=>{const n=document.getElementById("source");return n.getContext("2d").clearRect(0,0,n.width,n.height),await(t=e,new Promise((e=>{const n=document.getElementById("source"),i=n.getContext("2d"),r=new Image;r.setAttribute("crossOrigin",""),r.onload=()=>{let t=Math.max(r.width,r.height),a=Math.floor(r.width*(b.outputSize/t)),s=Math.floor(r.height*(b.outputSize/t));n.width=a,n.height=s,i.drawImage(r,0,0,r.width,r.height,0,0,a,s),e({width:a,height:s,imgData:i.getImageData(0,0,a,s)})},r.onerror=e=>{console.log(e)},r.src=t})));var t})(e);J.sendMessage("loading tensorflow models");for(let e in Q.models)null==Q.models[e]&&(Q.models[e]=await j(e));J.sendMessage("extracting colorscheme"),Q.colorscheme=await _(n,{distance:.2,splitPower:14,saturationImportance:.23}),Q.imgData=n,ne(n)};document.addEventListener("keypress",(e=>{" "==e.key?(b.playing=!b.playing,b.playing&&x(),e.preventDefault()):"s"==e.key&&(document.getElementById("source").classList.toggle("hidden"),M())}));const ie=document.getElementById("drop");ie.addEventListener("dragover",(function(e){this.classList.add("dragging"),e.preventDefault()})),ie.addEventListener("dragleave",(function(e){this.classList.remove("dragging"),e.preventDefault()})),ie.addEventListener("drop",(async function(e){if(this.classList.remove("dragging"),e.preventDefault(),e.dataTransfer.items)for(var n=0;n<e.dataTransfer.items.length;n++)if("file"===e.dataTransfer.items[n].kind&&e.dataTransfer.items[n].type.match("^image/")){var t=e.dataTransfer.items[n].getAsFile();te(URL.createObjectURL(t))}})),document.addEventListener("mousewheel",(e=>{G||(G=!0,requestAnimationFrame((()=>{let n=(1+.1*e.deltaY)*b.scale;b.scale=Math.max(.5,Math.min(1e3,n)),g(),b.playing||x(),G=!1}))),e.preventDefault()}),{passive:!1}),te(H)}},e=>{"use strict";e.O(0,[949,475,936,281,955,459,115],(()=>(9441,e(e.s=9441)))),e.O()}]);